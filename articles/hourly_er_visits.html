<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="srlTS">
<title>Modeling Multi-Modal Hourly Data • srlTS</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Modeling Multi-Modal Hourly Data">
<meta property="og:description" content="srlTS">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">srlTS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.900</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/srlTS.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/case_studies.html">Simple Case Studies</a>
    <a class="dropdown-item" href="../articles/hourly_er_visits.html">Modeling Multi-Modal Hourly Data</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="hourly_er_visits_files/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="hourly_er_visits_files/kePrint-0.0.1/kePrint.js"></script><link href="hourly_er_visits_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Modeling Multi-Modal Hourly Data</h1>
            
      
      
      <div class="d-none name"><code>hourly_er_visits.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="the-uihc_ed_arrivals-data-set">The <code>uihc_ed_arrivals</code> data set<a class="anchor" aria-label="anchor" href="#the-uihc_ed_arrivals-data-set"></a>
</h2>
<p>The University of Iowa Hospitals and Clinics (UIHC) Emergency Department Arrivals data set is included as a component of this package, and consists of 41,640 hourly counts of number of new arrivals into the ED spanning the years 2013-2018. See the data set documentation, <code><a href="../reference/uihc_ed_arrivals.html">?uihc_ed_arrivals</a></code>, for more information.</p>
</div>
<div class="section level2">
<h2 id="modeling-the-data">Modeling the data<a class="anchor" aria-label="anchor" href="#modeling-the-data"></a>
</h2>
<div class="section level3">
<h3 id="endogenous-model-srlpac">Endogenous model (SRLPAC)<a class="anchor" aria-label="anchor" href="#endogenous-model-srlpac"></a>
</h3>
<p>First we’ll load and summarize the data. Note that although we have plenty of information on year, month, and day, the data set has already been sorted by time.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"uihc_ed_arrivals"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">uihc_ed_arrivals</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    41640 obs. of  17 variables:</span></span>
<span><span class="co">#&gt;  $ Year    : num  2013 2013 2013 2013 2013 ...</span></span>
<span><span class="co">#&gt;  $ Quarter : Factor w/ 4 levels "Q1","Q2","Q3",..: 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ Month   : num  7 7 7 7 7 7 7 7 7 7 ...</span></span>
<span><span class="co">#&gt;  $ Day     : num  1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ Hour    : num  0 1 2 3 4 5 6 7 8 9 ...</span></span>
<span><span class="co">#&gt;  $ Arrivals: num  5 5 8 2 2 1 4 1 4 6 ...</span></span>
<span><span class="co">#&gt;  $ Date    : Date, format: "2013-07-01" "2013-07-01" ...</span></span>
<span><span class="co">#&gt;  $ Weekday : Ord.factor w/ 7 levels "Sun"&lt;"Mon"&lt;"Tue"&lt;..: 2 2 2 2 2 2 2 2 2 2 ...</span></span>
<span><span class="co">#&gt;  $ temp    : num  57 57 57 56 56 57 59 60 60 61 ...</span></span>
<span><span class="co">#&gt;  $ xmas    : num  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ xmas2   : num  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ nye     : num  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ nyd     : num  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ thx     : num  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ thx1    : num  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ ind     : num  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ game_day: num  0 0 0 0 0 0 0 0 0 0 ...</span></span></code></pre></div>
<p>Let’s pull out our outcome and look at it.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">uihc_ed_arrivals</span><span class="op">$</span><span class="va">Arrivals</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">y</span>, type <span class="op">=</span> <span class="st">"l"</span><span class="op">)</span></span></code></pre></div>
<p><img src="hourly_er_visits_files/figure-html/plot_outcome-1.png" width="672"></p>
<p>OK, not too helpful visually. Such is the trap of being so close to asymptopia. Let’s look a bit closer at the partial autocorrelation function to see what kind of seasonality and autoregressive (AR) structure we could be dealing with.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># number of maximum lags to consider</span></span>
<span><span class="va">n_lags_max</span> <span class="op">&lt;-</span> <span class="fl">24</span><span class="op">*</span><span class="fl">7</span><span class="op">*</span><span class="fl">5</span> <span class="co"># consider 5 weeks' data lags</span></span>
<span><span class="va">pacfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/acf.html" class="external-link">pacf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/ts.html" class="external-link">ts</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, lag.max <span class="op">=</span> <span class="va">n_lags_max</span>, plot <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pacfs</span><span class="op">)</span></span></code></pre></div>
<p><img src="hourly_er_visits_files/figure-html/plot_pacf-1.png" width="672"></p>
<p>Clearly we have multiple modes of seasonality in this hourly data, likely corresponding to observed shift-based, daily, and weekly patterns. Thankfully the sparsity ranked lasso (SRL) time series fitting procedure can handle this situation in stride.</p>
<p>We can fit an endogenous SRLPAC model using one line of code which might take 1-2 minutes to run:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">srlpac</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/srlTS.html">srlTS</a></span><span class="op">(</span><span class="va">y</span>, n_lags_max <span class="op">=</span> <span class="va">n_lags_max</span><span class="op">)</span></span></code></pre></div>
<p>We can investigate the performance of the SRLPAC model using associated <code>print</code>, <code>coef</code>, <code>summary</code>, and <code>plot</code> functions.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">srlpac</span></span>
<span><span class="co">#&gt;  PF_gamma best_AICc best_BIC</span></span>
<span><span class="co">#&gt;      0.00  155231.7 156254.6</span></span>
<span><span class="co">#&gt;      0.25  155195.8 155964.1</span></span>
<span><span class="co">#&gt;      0.50  155190.4 155939.0</span></span>
<span><span class="co">#&gt;      1.00  155457.4 155943.7</span></span>
<span><span class="co">#&gt;      2.00  157625.4 157826.7</span></span>
<span><span class="co">#&gt;      4.00  162570.0 162637.1</span></span>
<span><span class="co">#&gt;      8.00  169220.7 169245.9</span></span>
<span><span class="co">#&gt;     16.00  169220.7 169245.9</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Test-set prediction accuracy</span></span>
<span><span class="co">#&gt;         rmse       rsq      mae</span></span>
<span><span class="co">#&gt; AIC 2.661505 0.5310037 2.059681</span></span>
<span><span class="co">#&gt; BIC 2.664962 0.5298691 2.064657</span></span></code></pre></div>
<p>By default, <code>srlTS</code> used 8 possible tuning parameters for <span class="math inline">\(\gamma\)</span>, the penalty weight exponent, and using AICc as a judge it appears the best value is 0.5. By default, the argument <code>p_train</code> is set to 0.8, which means we also get prediction accuracy for a left-out 20% of the data, and revealing an R-squared of 53.1%, meaning that about half of the variance in hourly visits to the ED can be explained by multi-modal seasonal and local autoregressive patterns.</p>
<p>The lasso’s solution path for these lags can be seen via the <code>plot</code> function.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">srlpac</span><span class="op">)</span></span></code></pre></div>
<p><img src="hourly_er_visits_files/figure-html/plot_endo-1.png" width="672"></p>
<p>To see the (long) list of selected coefficients, the <code>summary</code> function can be used.</p>
<details><p><summary>Expand to see output</summary></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">srlpac</span><span class="op">)</span></span>
<span><span class="co">#&gt; Using a basic kernel estimate for local fdr; consider installing the ashr package for more accurate estimation.  See ?local_mfdr</span></span>
<span><span class="co">#&gt; Model summary at optimal AICc (lambda=0.0015; gamma=0.5)</span></span>
<span><span class="co">#&gt; lasso-penalized linear regression with n=32472, p=840</span></span>
<span><span class="co">#&gt; At lambda=0.0015:</span></span>
<span><span class="co">#&gt; -------------------------------------------------</span></span>
<span><span class="co">#&gt;   Nonzero coefficients         : 201</span></span>
<span><span class="co">#&gt;   Expected nonzero coefficients: 124.63</span></span>
<span><span class="co">#&gt;   Average mfdr (201 features)  :   0.620</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;          Estimate       z       mfdr Selected</span></span>
<span><span class="co">#&gt; lag1    5.047e-02 13.5997    &lt; 1e-04        *</span></span>
<span><span class="co">#&gt; lag168  3.075e-02  8.6541    &lt; 1e-04        *</span></span>
<span><span class="co">#&gt; lag336  3.011e-02  8.5221    &lt; 1e-04        *</span></span>
<span><span class="co">#&gt; lag840  2.720e-02  7.9715    &lt; 1e-04        *</span></span>
<span><span class="co">#&gt; lag504  2.760e-02  7.9247    &lt; 1e-04        *</span></span>
<span><span class="co">#&gt; lag673  2.577e-02  7.5147    &lt; 1e-04        *</span></span>
<span><span class="co">#&gt; lag505  2.590e-02  7.4932    &lt; 1e-04        *</span></span>
<span><span class="co">#&gt; lag672  2.494e-02  7.3047    &lt; 1e-04        *</span></span>
<span><span class="co">#&gt; lag337  2.465e-02  7.1122    &lt; 1e-04        *</span></span>
<span><span class="co">#&gt; lag3    2.395e-02  6.7734    &lt; 1e-04        *</span></span>
<span><span class="co">#&gt; lag503  2.304e-02  6.7301    &lt; 1e-04        *</span></span>
<span><span class="co">#&gt; lag167  2.305e-02  6.6151    &lt; 1e-04        *</span></span>
<span><span class="co">#&gt; lag671  2.093e-02  6.2762    &lt; 1e-04        *</span></span>
<span><span class="co">#&gt; lag170  2.136e-02  6.2511    &lt; 1e-04        *</span></span>
<span><span class="co">#&gt; lag2    2.248e-02  6.2089    &lt; 1e-04        *</span></span>
<span><span class="co">#&gt; lag47   2.191e-02  6.2032    &lt; 1e-04        *</span></span>
<span><span class="co">#&gt; lag144  2.013e-02  5.8676    &lt; 1e-04        *</span></span>
<span><span class="co">#&gt; lag432  1.908e-02  5.7448    &lt; 1e-04        *</span></span>
<span><span class="co">#&gt; lag72   1.985e-02  5.6922    &lt; 1e-04        *</span></span>
<span><span class="co">#&gt; lag674  1.752e-02  5.4118    &lt; 1e-04        *</span></span>
<span><span class="co">#&gt; lag24   1.899e-02  5.3635    &lt; 1e-04        *</span></span>
<span><span class="co">#&gt; lag96   1.828e-02  5.3247    &lt; 1e-04        *</span></span>
<span><span class="co">#&gt; lag647  1.662e-02  5.1731    &lt; 1e-04        *</span></span>
<span><span class="co">#&gt; lag839  1.594e-02  5.1414    &lt; 1e-04        *</span></span>
<span><span class="co">#&gt; lag71   1.780e-02  5.1341    &lt; 1e-04        *</span></span>
<span><span class="co">#&gt; lag335  1.643e-02  4.9851    &lt; 1e-04        *</span></span>
<span><span class="co">#&gt; lag73   1.679e-02  4.9224 0.00012924        *</span></span>
<span><span class="co">#&gt; lag166  1.649e-02  4.9127 0.00013687        *</span></span>
<span><span class="co">#&gt; lag528  1.511e-02  4.8434 0.00021101        *</span></span>
<span><span class="co">#&gt; lag22   1.702e-02  4.8170 0.00025250        *</span></span>
<span><span class="co">#&gt; lag23   1.687e-02  4.7827 0.00032225        *</span></span>
<span><span class="co">#&gt; lag283 -1.541e-02 -4.7905 0.00117894        *</span></span>
<span><span class="co">#&gt; lag644 -1.410e-02 -4.5745 0.00324570        *</span></span>
<span><span class="co">#&gt; lag481  1.334e-02  4.2374 0.00578817        *</span></span>
<span><span class="co">#&gt; lag192  1.299e-02  4.1148 0.00659483        *</span></span>
<span><span class="co">#&gt; lag190  1.246e-02  4.0150 0.00787831        *</span></span>
<span><span class="co">#&gt; lag169  1.282e-02  3.9885 0.00834837        *</span></span>
<span><span class="co">#&gt; lag838  1.104e-02  3.9208 0.00986811        *</span></span>
<span><span class="co">#&gt; lag600  1.139e-02  3.8620 0.01169054        *</span></span>
<span><span class="co">#&gt; lag648  1.110e-02  3.7956 0.01447996        *</span></span>
<span><span class="co">#&gt; lag649  1.097e-02  3.7373 0.01783076        *</span></span>
<span><span class="co">#&gt; lag143  1.197e-02  3.7338 0.01806154        *</span></span>
<span><span class="co">#&gt; lag25   1.242e-02  3.6694 0.02332690        *</span></span>
<span><span class="co">#&gt; lag6    1.245e-02  3.6057 0.03075707        *</span></span>
<span><span class="co">#&gt; lag670  1.029e-02  3.5438 0.04120586        *</span></span>
<span><span class="co">#&gt; lag770  9.780e-03  3.5034 0.05043729        *</span></span>
<span><span class="co">#&gt; lag338  1.036e-02  3.4741 0.05863041        *</span></span>
<span><span class="co">#&gt; lag520 -1.114e-02 -3.7583 0.07077636        *</span></span>
<span><span class="co">#&gt; lag533 -1.006e-02 -3.5702 0.08643562        *</span></span>
<span><span class="co">#&gt; lag317 -9.565e-03 -3.4451 0.10139174        *</span></span>
<span><span class="co">#&gt; lag241  9.869e-03  3.3625 0.10348058        *</span></span>
<span><span class="co">#&gt; lag152 -9.465e-03 -3.2413 0.13291889        *</span></span>
<span><span class="co">#&gt; lag212 -9.045e-03 -3.2280 0.13590142        *</span></span>
<span><span class="co">#&gt; lag700 -8.466e-03 -3.1938 0.14428893        *</span></span>
<span><span class="co">#&gt; lag462 -8.431e-03 -3.1205 0.16765963        *</span></span>
<span><span class="co">#&gt; lag634 -7.853e-03 -3.0316 0.21023330        *</span></span>
<span><span class="co">#&gt; lag502  8.282e-03  2.9906 0.22748657        *</span></span>
<span><span class="co">#&gt; lag263  8.436e-03  2.9902 0.22757536        *</span></span>
<span><span class="co">#&gt; lag288  8.089e-03  2.9506 0.23613700        *</span></span>
<span><span class="co">#&gt; lag191  8.389e-03  2.9402 0.23868476        *</span></span>
<span><span class="co">#&gt; lag816  7.216e-03  2.9364 0.23964450        *</span></span>
<span><span class="co">#&gt; lag4    9.260e-03  2.9319 0.24079490        *</span></span>
<span><span class="co">#&gt; lag547 -7.587e-03 -2.9837 0.24196266        *</span></span>
<span><span class="co">#&gt; lag519 -7.779e-03 -2.9828 0.24261208        *</span></span>
<span><span class="co">#&gt; lag575  6.819e-03  2.7771 0.29361989        *</span></span>
<span><span class="co">#&gt; lag316 -7.387e-03 -2.9072 0.31061649        *</span></span>
<span><span class="co">#&gt; lag26   8.463e-03  2.7197 0.31808234        *</span></span>
<span><span class="co">#&gt; lag214  6.894e-03  2.6843 0.33398265        *</span></span>
<span><span class="co">#&gt; lag46   8.541e-03  2.6800 0.33590529        *</span></span>
<span><span class="co">#&gt; lag492 -6.765e-03 -2.8788 0.34297048        *</span></span>
<span><span class="co">#&gt; lag564  6.785e-03  2.6438 0.35259573        *</span></span>
<span><span class="co">#&gt; lag145  7.483e-03  2.6102 0.36851885        *</span></span>
<span><span class="co">#&gt; lag121  7.381e-03  2.5599 0.39306042        *</span></span>
<span><span class="co">#&gt; lag55   1.701e-03  2.5127 0.41738231        *</span></span>
<span><span class="co">#&gt; lag40   5.068e-03  2.5026 0.42284245        *</span></span>
<span><span class="co">#&gt; lag334  6.476e-03  2.4806 0.43499775        *</span></span>
<span><span class="co">#&gt; lag440  5.460e-03  2.4031 0.48283202        *</span></span>
<span><span class="co">#&gt; lag312  6.049e-03  2.3948 0.48848405        *</span></span>
<span><span class="co">#&gt; lag792  4.504e-03  2.3945 0.48870811        *</span></span>
<span><span class="co">#&gt; lag696  3.688e-03  2.3900 0.49181933        *</span></span>
<span><span class="co">#&gt; lag7    7.894e-03  2.3793 0.49936433        *</span></span>
<span><span class="co">#&gt; lag142  6.509e-03  2.3462 0.52449501        *</span></span>
<span><span class="co">#&gt; lag37  -8.194e-03 -2.7582 0.53142891        *</span></span>
<span><span class="co">#&gt; lag264  5.775e-03  2.2844 0.57848564        *</span></span>
<span><span class="co">#&gt; lag615  4.703e-03  2.2487 0.61417945        *</span></span>
<span><span class="co">#&gt; lag8    7.358e-03  2.2373 0.62625252        *</span></span>
<span><span class="co">#&gt; lag116 -6.727e-03 -2.6938 0.66474447        *</span></span>
<span><span class="co">#&gt; lag119  6.131e-03  2.1880 0.68266674        *</span></span>
<span><span class="co">#&gt; lag697  3.769e-03  2.1711 0.70363651        *</span></span>
<span><span class="co">#&gt; lag479  4.822e-03  2.1663 0.70966547        *</span></span>
<span><span class="co">#&gt; lag722  3.862e-03  2.1559 0.72298340        *</span></span>
<span><span class="co">#&gt; lag781  5.059e-03  2.1534 0.72614207        *</span></span>
<span><span class="co">#&gt; lag384  4.518e-03  2.1383 0.74594804        *</span></span>
<span><span class="co">#&gt; lag216  4.961e-03  2.1265 0.76177334        *</span></span>
<span><span class="co">#&gt; lag580 -5.824e-03 -2.6429 0.77812056        *</span></span>
<span><span class="co">#&gt; lag360  4.369e-03  2.1069 0.78857230        *</span></span>
<span><span class="co">#&gt; lag817  3.194e-03  2.0851 0.81897597        *</span></span>
<span><span class="co">#&gt; lag406  3.941e-03  2.0759 0.83214380        *</span></span>
<span><span class="co">#&gt; lag11  -3.313e-04 -0.3710 0.88337658        *</span></span>
<span><span class="co">#&gt; lag266  4.313e-03  2.0302 0.89765999        *</span></span>
<span><span class="co">#&gt; lag70   5.802e-03  2.0072 0.93095507        *</span></span>
<span><span class="co">#&gt; lag60  -8.267e-04 -0.9440 0.96962579        *</span></span>
<span><span class="co">#&gt; lag5    1.796e-03  0.7846 1.00000000        *</span></span>
<span><span class="co">#&gt; lag10   4.621e-03  1.5155 1.00000000        *</span></span>
<span><span class="co">#&gt; lag13   3.796e-03  1.3676 1.00000000        *</span></span>
<span><span class="co">#&gt; lag15   9.660e-04  0.8174 1.00000000        *</span></span>
<span><span class="co">#&gt; lag18   3.299e-03  1.4689 1.00000000        *</span></span>
<span><span class="co">#&gt; lag21   5.688e-03  1.8231 1.00000000        *</span></span>
<span><span class="co">#&gt; lag30   5.488e-04  0.9108 1.00000000        *</span></span>
<span><span class="co">#&gt; lag32   1.548e-03  1.2160 1.00000000        *</span></span>
<span><span class="co">#&gt; lag34   3.990e-03  1.7879 1.00000000        *</span></span>
<span><span class="co">#&gt; lag41  -1.492e-03 -1.3014 1.00000000        *</span></span>
<span><span class="co">#&gt; lag50  -1.587e-03 -1.2593 1.00000000        *</span></span>
<span><span class="co">#&gt; lag54  -3.115e-03 -1.4952 1.00000000        *</span></span>
<span><span class="co">#&gt; lag58   5.343e-04  1.1262 1.00000000        *</span></span>
<span><span class="co">#&gt; lag74   4.818e-03  1.9117 1.00000000        *</span></span>
<span><span class="co">#&gt; lag76  -3.985e-03 -1.8829 1.00000000        *</span></span>
<span><span class="co">#&gt; lag84  -3.251e-03 -1.6239 1.00000000        *</span></span>
<span><span class="co">#&gt; lag92   1.436e-03  1.3917 1.00000000        *</span></span>
<span><span class="co">#&gt; lag95   4.709e-03  1.7707 1.00000000        *</span></span>
<span><span class="co">#&gt; lag97   4.139e-03  1.6618 1.00000000        *</span></span>
<span><span class="co">#&gt; lag112  2.772e-04  1.1772 1.00000000        *</span></span>
<span><span class="co">#&gt; lag120  4.499e-03  1.7794 1.00000000        *</span></span>
<span><span class="co">#&gt; lag126 -1.122e-03 -1.0248 1.00000000        *</span></span>
<span><span class="co">#&gt; lag133 -6.166e-04 -1.2922 1.00000000        *</span></span>
<span><span class="co">#&gt; lag136  2.052e-03  1.7073 1.00000000        *</span></span>
<span><span class="co">#&gt; lag141  3.818e-03  1.7347 1.00000000        *</span></span>
<span><span class="co">#&gt; lag148 -2.829e-03 -1.6247 1.00000000        *</span></span>
<span><span class="co">#&gt; lag149 -4.482e-03 -1.9845 1.00000000        *</span></span>
<span><span class="co">#&gt; lag150 -3.738e-03 -1.8145 1.00000000        *</span></span>
<span><span class="co">#&gt; lag154 -1.846e-03 -1.4016 1.00000000        *</span></span>
<span><span class="co">#&gt; lag165  1.002e-05  0.7632 1.00000000        *</span></span>
<span><span class="co">#&gt; lag172 -3.634e-03 -1.9687 1.00000000        *</span></span>
<span><span class="co">#&gt; lag185 -6.248e-03 -2.4878 1.00000000        *</span></span>
<span><span class="co">#&gt; lag189  1.049e-03  1.2842 1.00000000        *</span></span>
<span><span class="co">#&gt; lag193  1.743e-03  1.3299 1.00000000        *</span></span>
<span><span class="co">#&gt; lag196 -1.283e-03 -1.3630 1.00000000        *</span></span>
<span><span class="co">#&gt; lag198 -1.105e-03 -1.3789 1.00000000        *</span></span>
<span><span class="co">#&gt; lag204 -6.142e-04 -1.2745 1.00000000        *</span></span>
<span><span class="co">#&gt; lag211 -5.535e-04 -1.1453 1.00000000        *</span></span>
<span><span class="co">#&gt; lag217  2.580e-03  1.6224 1.00000000        *</span></span>
<span><span class="co">#&gt; lag232  3.133e-03  1.8421 1.00000000        *</span></span>
<span><span class="co">#&gt; lag255  2.685e-03  1.7900 1.00000000        *</span></span>
<span><span class="co">#&gt; lag259 -1.317e-03 -1.3618 1.00000000        *</span></span>
<span><span class="co">#&gt; lag287  2.728e-03  1.6777 1.00000000        *</span></span>
<span><span class="co">#&gt; lag295 -2.249e-04 -1.1144 1.00000000        *</span></span>
<span><span class="co">#&gt; lag311  9.230e-04  1.1582 1.00000000        *</span></span>
<span><span class="co">#&gt; lag315 -8.906e-05 -1.2992 1.00000000        *</span></span>
<span><span class="co">#&gt; lag322 -1.336e-03 -1.5794 1.00000000        *</span></span>
<span><span class="co">#&gt; lag356 -1.982e-03 -1.4913 1.00000000        *</span></span>
<span><span class="co">#&gt; lag359  2.203e-03  1.5691 1.00000000        *</span></span>
<span><span class="co">#&gt; lag364 -1.817e-03 -1.4860 1.00000000        *</span></span>
<span><span class="co">#&gt; lag389 -1.459e-03 -1.3790 1.00000000        *</span></span>
<span><span class="co">#&gt; lag397  3.209e-03  1.8182 1.00000000        *</span></span>
<span><span class="co">#&gt; lag402  3.410e-03  1.8544 1.00000000        *</span></span>
<span><span class="co">#&gt; lag408  6.127e-04  1.2396 1.00000000        *</span></span>
<span><span class="co">#&gt; lag409  1.209e-03  1.4095 1.00000000        *</span></span>
<span><span class="co">#&gt; lag456  2.063e-03  1.6446 1.00000000        *</span></span>
<span><span class="co">#&gt; lag461 -1.487e-03 -1.4587 1.00000000        *</span></span>
<span><span class="co">#&gt; lag463 -5.048e-03 -2.2758 1.00000000        *</span></span>
<span><span class="co">#&gt; lag480  2.448e-03  1.6650 1.00000000        *</span></span>
<span><span class="co">#&gt; lag489 -5.052e-03 -2.3007 1.00000000        *</span></span>
<span><span class="co">#&gt; lag491 -4.405e-03 -2.3206 1.00000000        *</span></span>
<span><span class="co">#&gt; lag501  3.295e-03  1.8219 1.00000000        *</span></span>
<span><span class="co">#&gt; lag506  2.372e-03  1.6797 1.00000000        *</span></span>
<span><span class="co">#&gt; lag515 -2.407e-03 -1.7750 1.00000000        *</span></span>
<span><span class="co">#&gt; lag518 -2.619e-03 -1.7741 1.00000000        *</span></span>
<span><span class="co">#&gt; lag524 -4.711e-03 -2.2013 1.00000000        *</span></span>
<span><span class="co">#&gt; lag531 -1.243e-03 -1.3870 1.00000000        *</span></span>
<span><span class="co">#&gt; lag552  1.179e-03  1.6796 1.00000000        *</span></span>
<span><span class="co">#&gt; lag553  1.176e-03  1.5669 1.00000000        *</span></span>
<span><span class="co">#&gt; lag569  1.012e-03  1.3497 1.00000000        *</span></span>
<span><span class="co">#&gt; lag579 -3.673e-03 -1.9986 1.00000000        *</span></span>
<span><span class="co">#&gt; lag592  1.722e-04  1.0859 1.00000000        *</span></span>
<span><span class="co">#&gt; lag611 -4.434e-03 -2.2845 1.00000000        *</span></span>
<span><span class="co">#&gt; lag616  5.466e-04  1.2661 1.00000000        *</span></span>
<span><span class="co">#&gt; lag638 -4.583e-03 -2.1926 1.00000000        *</span></span>
<span><span class="co">#&gt; lag639  3.052e-03  1.8619 1.00000000        *</span></span>
<span><span class="co">#&gt; lag640  3.465e-04  1.2975 1.00000000        *</span></span>
<span><span class="co">#&gt; lag642 -1.341e-03 -1.4342 1.00000000        *</span></span>
<span><span class="co">#&gt; lag660 -3.190e-03 -2.0548 1.00000000        *</span></span>
<span><span class="co">#&gt; lag676 -4.239e-04 -1.2965 1.00000000        *</span></span>
<span><span class="co">#&gt; lag677 -2.231e-03 -1.7961 1.00000000        *</span></span>
<span><span class="co">#&gt; lag685 -3.053e-03 -2.1499 1.00000000        *</span></span>
<span><span class="co">#&gt; lag692 -1.303e-03 -1.4646 1.00000000        *</span></span>
<span><span class="co">#&gt; lag693  4.405e-04  1.2581 1.00000000        *</span></span>
<span><span class="co">#&gt; lag701 -1.181e-03 -1.5956 1.00000000        *</span></span>
<span><span class="co">#&gt; lag712 -2.882e-03 -1.7862 1.00000000        *</span></span>
<span><span class="co">#&gt; lag713 -1.645e-03 -1.5430 1.00000000        *</span></span>
<span><span class="co">#&gt; lag716 -5.414e-04 -1.3492 1.00000000        *</span></span>
<span><span class="co">#&gt; lag719  1.363e-03  1.7168 1.00000000        *</span></span>
<span><span class="co">#&gt; lag727 -2.566e-03 -1.7564 1.00000000        *</span></span>
<span><span class="co">#&gt; lag744  1.899e-03  1.7906 1.00000000        *</span></span>
<span><span class="co">#&gt; lag747 -1.567e-04 -1.3046 1.00000000        *</span></span>
<span><span class="co">#&gt; lag748 -1.401e-03 -1.6702 1.00000000        *</span></span>
<span><span class="co">#&gt; lag753  1.059e-03  1.2851 1.00000000        *</span></span>
<span><span class="co">#&gt; lag775  3.850e-04  1.1682 1.00000000        *</span></span>
<span><span class="co">#&gt; lag779 -1.751e-03 -1.8628 1.00000000        *</span></span>
<span><span class="co">#&gt; lag796 -2.115e-03 -1.7097 1.00000000        *</span></span>
<span><span class="co">#&gt; lag819  6.947e-05  1.0180 1.00000000        *</span></span>
<span><span class="co">#&gt; lag837  1.591e-03  1.4840 1.00000000        *</span></span></code></pre></div>
</details>
</div>
<div class="section level3">
<h3 id="exogenous-model-srlpacx">Exogenous model (SRLPACx)<a class="anchor" aria-label="anchor" href="#exogenous-model-srlpacx"></a>
</h3>
<p>It’s slightly more work to add exogenous features, which might help us add in fixed effects of weekday, temperature, and holiday indicators. The extra work is setting up the matrix of exogenous features.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">X_day</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">uihc_ed_arrivals</span>, <span class="va">xmas</span><span class="op">:</span><span class="va">game_day</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">X_month</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/relevel.html" class="external-link">relevel</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Month</span><span class="op">)</span>, ref <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">temp</span><span class="op">/</span><span class="fl">10</span><span class="op">)</span>, </span>
<span>                        data <span class="op">=</span> <span class="va">uihc_ed_arrivals</span><span class="op">)</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">X_month</span>, <span class="va">X_day</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"relevel.factor.Month., ref = 3."</span>, <span class="st">"Month"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Month1 Month2 Month4 Month5 Month6 Month7 Month8 Month9 Month10 Month11</span></span>
<span><span class="co">#&gt; 1      0      0      0      0      0      1      0      0       0       0</span></span>
<span><span class="co">#&gt; 2      0      0      0      0      0      1      0      0       0       0</span></span>
<span><span class="co">#&gt; 3      0      0      0      0      0      1      0      0       0       0</span></span>
<span><span class="co">#&gt; 4      0      0      0      0      0      1      0      0       0       0</span></span>
<span><span class="co">#&gt; 5      0      0      0      0      0      1      0      0       0       0</span></span>
<span><span class="co">#&gt; 6      0      0      0      0      0      1      0      0       0       0</span></span>
<span><span class="co">#&gt;   Month12 I(temp/10) xmas xmas2 nye nyd thx thx1 ind game_day</span></span>
<span><span class="co">#&gt; 1       0        5.7    0     0   0   0   0    0   0        0</span></span>
<span><span class="co">#&gt; 2       0        5.7    0     0   0   0   0    0   0        0</span></span>
<span><span class="co">#&gt; 3       0        5.7    0     0   0   0   0    0   0        0</span></span>
<span><span class="co">#&gt; 4       0        5.6    0     0   0   0   0    0   0        0</span></span>
<span><span class="co">#&gt; 5       0        5.6    0     0   0   0   0    0   0        0</span></span>
<span><span class="co">#&gt; 6       0        5.7    0     0   0   0   0    0   0        0</span></span></code></pre></div>
<p>The result is a model matrix with month indicators (reference is March), a scaled temperature covariate, and holiday indicator variables. Now that we have our matrix of exogenous features, we can pass this to <code>srlTS</code> to get our SRLPACx model. We also set <code>w_exo="unpenalized"</code> which will allow us to conduct statistical inference on the exogenous variable coefficients (by default, they will be penalized using adaptive-lasso-style penalty weights, which makes formal inference more difficult).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">srlpacx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/srlTS.html">srlTS</a></span><span class="op">(</span><span class="va">y</span>, X<span class="op">=</span><span class="va">X</span>, n_lags_max <span class="op">=</span> <span class="va">n_lags_max</span>, w_exo <span class="op">=</span> <span class="st">"unpenalized"</span><span class="op">)</span></span></code></pre></div>
<p>The same S3 methods apply and can be used to investigate the performance of the SLRPACx model.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">srlpacx</span></span>
<span><span class="co">#&gt;  PF_gamma best_AICc best_BIC</span></span>
<span><span class="co">#&gt;      0.00  155062.8 156237.2</span></span>
<span><span class="co">#&gt;      0.25  155023.3 155978.9</span></span>
<span><span class="co">#&gt;      0.50  155007.5 155974.7</span></span>
<span><span class="co">#&gt;      1.00  155300.0 155997.0</span></span>
<span><span class="co">#&gt;      2.00  157356.9 157742.6</span></span>
<span><span class="co">#&gt;      4.00  162064.9 162308.1</span></span>
<span><span class="co">#&gt;      8.00  168573.6 168766.5</span></span>
<span><span class="co">#&gt;     16.00  168573.6 168766.5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Test-set prediction accuracy</span></span>
<span><span class="co">#&gt;         rmse       rsq      mae</span></span>
<span><span class="co">#&gt; AIC 2.656204 0.5328857 2.054256</span></span>
<span><span class="co">#&gt; BIC 2.658211 0.5321868 2.057566</span></span></code></pre></div>
<p>Again, <code>srlTS</code> used 8 possible tuning parameters for <span class="math inline">\(\gamma\)</span>, and it appears the best value is 0.5. The addition of exogenous features has slightly improved the prediction accuracy on the left-out test data, with an R-squared of 53.3%. This may appear to be a very small increase, but it could add up (as we will see shortly) when predictions are made multiple steps ahead, or when the cumulative sum of predictions is of interest.</p>
<p>The lasso’s solution path for these lags can be seen via the <code>plot</code> function.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">srlpacx</span><span class="op">)</span></span></code></pre></div>
<p><img src="hourly_er_visits_files/figure-html/plot_exo-1.png" width="672"></p>
<p>To see the (long) list of selected coefficients, the <code>summary</code> function can be used. In this case, we’re most interested in the exogenous features, which can be extracted via the <code>unpenTable</code> object in the results returned from <code>summary</code> (this is thanks in large part to the <code>ncvreg</code> package).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">srlpacx</span><span class="op">)</span></span>
<span><span class="va">s</span><span class="op">$</span><span class="va">unpenTable</span> </span></code></pre></div>
<table class="table  lightable-minimal" style='font-family: "Trebuchet MS", verdana, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
std.error
</th>
<th style="text-align:right;">
statistic
</th>
<th style="text-align:left;">
p.value
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Month1
</td>
<td style="text-align:right;">
0.09
</td>
<td style="text-align:right;">
0.07
</td>
<td style="text-align:right;">
1.29
</td>
<td style="text-align:left;">
0.20
</td>
</tr>
<tr>
<td style="text-align:left;">
Month2
</td>
<td style="text-align:right;">
0.04
</td>
<td style="text-align:right;">
0.07
</td>
<td style="text-align:right;">
0.58
</td>
<td style="text-align:left;">
0.56
</td>
</tr>
<tr>
<td style="text-align:left;">
Month4
</td>
<td style="text-align:right;">
-0.17
</td>
<td style="text-align:right;">
0.07
</td>
<td style="text-align:right;">
-2.36
</td>
<td style="text-align:left;">
0.018
</td>
</tr>
<tr>
<td style="text-align:left;">
Month5
</td>
<td style="text-align:right;">
-0.43
</td>
<td style="text-align:right;">
0.08
</td>
<td style="text-align:right;">
-5.44
</td>
<td style="text-align:left;">
&lt; 0.001
</td>
</tr>
<tr>
<td style="text-align:left;">
Month6
</td>
<td style="text-align:right;">
-0.65
</td>
<td style="text-align:right;">
0.09
</td>
<td style="text-align:right;">
-7.51
</td>
<td style="text-align:left;">
&lt; 0.001
</td>
</tr>
<tr>
<td style="text-align:left;">
Month7
</td>
<td style="text-align:right;">
-0.50
</td>
<td style="text-align:right;">
0.09
</td>
<td style="text-align:right;">
-5.77
</td>
<td style="text-align:left;">
&lt; 0.001
</td>
</tr>
<tr>
<td style="text-align:left;">
Month8
</td>
<td style="text-align:right;">
-0.42
</td>
<td style="text-align:right;">
0.08
</td>
<td style="text-align:right;">
-5.07
</td>
<td style="text-align:left;">
&lt; 0.001
</td>
</tr>
<tr>
<td style="text-align:left;">
Month9
</td>
<td style="text-align:right;">
-0.27
</td>
<td style="text-align:right;">
0.08
</td>
<td style="text-align:right;">
-3.38
</td>
<td style="text-align:left;">
&lt; 0.001
</td>
</tr>
<tr>
<td style="text-align:left;">
Month10
</td>
<td style="text-align:right;">
-0.45
</td>
<td style="text-align:right;">
0.07
</td>
<td style="text-align:right;">
-6.38
</td>
<td style="text-align:left;">
&lt; 0.001
</td>
</tr>
<tr>
<td style="text-align:left;">
Month11
</td>
<td style="text-align:right;">
-0.29
</td>
<td style="text-align:right;">
0.07
</td>
<td style="text-align:right;">
-4.14
</td>
<td style="text-align:left;">
&lt; 0.001
</td>
</tr>
<tr>
<td style="text-align:left;">
Month12
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.07
</td>
<td style="text-align:right;">
0.06
</td>
<td style="text-align:left;">
0.95
</td>
</tr>
<tr>
<td style="text-align:left;">
I(temp/10)
</td>
<td style="text-align:right;">
0.14
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
9.96
</td>
<td style="text-align:left;">
&lt; 0.001
</td>
</tr>
<tr>
<td style="text-align:left;">
xmas
</td>
<td style="text-align:right;">
-1.43
</td>
<td style="text-align:right;">
0.27
</td>
<td style="text-align:right;">
-5.26
</td>
<td style="text-align:left;">
&lt; 0.001
</td>
</tr>
<tr>
<td style="text-align:left;">
xmas2
</td>
<td style="text-align:right;">
0.76
</td>
<td style="text-align:right;">
0.27
</td>
<td style="text-align:right;">
2.79
</td>
<td style="text-align:left;">
0.005
</td>
</tr>
<tr>
<td style="text-align:left;">
nye
</td>
<td style="text-align:right;">
-0.51
</td>
<td style="text-align:right;">
0.27
</td>
<td style="text-align:right;">
-1.88
</td>
<td style="text-align:left;">
0.061
</td>
</tr>
<tr>
<td style="text-align:left;">
nyd
</td>
<td style="text-align:right;">
-0.14
</td>
<td style="text-align:right;">
0.27
</td>
<td style="text-align:right;">
-0.51
</td>
<td style="text-align:left;">
0.61
</td>
</tr>
<tr>
<td style="text-align:left;">
thx
</td>
<td style="text-align:right;">
-1.47
</td>
<td style="text-align:right;">
0.27
</td>
<td style="text-align:right;">
-5.39
</td>
<td style="text-align:left;">
&lt; 0.001
</td>
</tr>
<tr>
<td style="text-align:left;">
thx1
</td>
<td style="text-align:right;">
0.44
</td>
<td style="text-align:right;">
0.28
</td>
<td style="text-align:right;">
1.60
</td>
<td style="text-align:left;">
0.11
</td>
</tr>
<tr>
<td style="text-align:left;">
ind
</td>
<td style="text-align:right;">
-0.59
</td>
<td style="text-align:right;">
0.31
</td>
<td style="text-align:right;">
-1.90
</td>
<td style="text-align:left;">
0.058
</td>
</tr>
<tr>
<td style="text-align:left;">
game_day
</td>
<td style="text-align:right;">
0.03
</td>
<td style="text-align:right;">
0.11
</td>
<td style="text-align:right;">
0.25
</td>
<td style="text-align:left;">
0.80
</td>
</tr>
</tbody>
</table>
<p>Or we can make a nice looking figure.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">b</span> <span class="op">&lt;-</span> <span class="va">s</span><span class="op">$</span><span class="va">unpenTable</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">se_b</span> <span class="op">&lt;-</span> <span class="va">s</span><span class="op">$</span><span class="va">unpenTable</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span></span>
<span><span class="va">ci_lb</span> <span class="op">&lt;-</span> <span class="va">b</span> <span class="op">-</span> <span class="va">se_b</span> <span class="op">*</span> <span class="fl">1.96</span></span>
<span><span class="va">ci_ub</span> <span class="op">&lt;-</span> <span class="va">b</span> <span class="op">+</span> <span class="va">se_b</span> <span class="op">*</span> <span class="fl">1.96</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">9</span>,<span class="fl">4</span>,<span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fl">.1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">b</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">se_b</span><span class="op">)</span><span class="op">:</span><span class="fl">1</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">ci_lb</span>, <span class="va">ci_ub</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fl">20</span>,</span>
<span>     col <span class="op">=</span> <span class="fl">4</span>, yaxt <span class="op">=</span> <span class="st">"n"</span>, ylab <span class="op">=</span> <span class="st">""</span>, xlab <span class="op">=</span> <span class="st">"Coefficient (Change in Hourly ER visits)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fl">0</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/segments.html" class="external-link">segments</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">ci_lb</span>, x1 <span class="op">=</span> <span class="va">ci_ub</span>, y0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">se_b</span><span class="op">)</span><span class="op">:</span><span class="fl">1</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">labs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"factor\\(Month\\)"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">b</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">labs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">month.name</span><span class="op">[</span><span class="op">-</span><span class="fl">3</span><span class="op">]</span>, <span class="st">"10-degree (F)"</span>, <span class="st">"Christmas"</span>, <span class="st">"Christmas+1"</span>,</span>
<span>          <span class="st">"New Year's Eve"</span>, <span class="st">"New Years Day"</span>,</span>
<span>          <span class="st">"Thanksgiving"</span>, <span class="st">"Thanksgiving+1"</span>, <span class="st">"Independence Day"</span>,</span>
<span>          <span class="st">"Hawkeye Gameday"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">se_b</span><span class="op">)</span><span class="op">:</span><span class="fl">1</span>, <span class="va">labs</span>, las <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="hourly_er_visits_files/figure-html/plot_exo_coefs-1.png" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="making-predictions">Making predictions<a class="anchor" aria-label="anchor" href="#making-predictions"></a>
</h2>
<p>For time series models such as the ones we fit with SRLPAC, it is straightforward to get 1-step-ahead predictions.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_1step_endo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">srlpac</span><span class="op">)</span></span>
<span><span class="va">p_1step_exo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">srlpacx</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="k-step-ahead-predictions">k-step ahead predictions<a class="anchor" aria-label="anchor" href="#k-step-ahead-predictions"></a>
</h3>
<p>It’s a bit more involved of a process to get 2, 3, or <span class="math inline">\(k\)</span>-step ahead predictions computationally, as the the 1-step through <span class="math inline">\(k-1\)</span>-step predictions must be computed iteratively in order to get <span class="math inline">\(k\)</span>-step ahead predictions. From a user’s perspective, it’s still straightforward though.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_2step_endo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">srlpac</span>, n_ahead <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">p_2step_exo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">srlpacx</span>, n_ahead <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_10step_endo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">srlpac</span>, n_ahead <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">p_10step_exo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">srlpacx</span>, n_ahead <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">p_1step_endo</span>, <span class="va">p_2step_endo</span>, <span class="va">p_10step_endo</span>, </span>
<span>               <span class="va">p_1step_exo</span>, <span class="va">p_2step_exo</span>, <span class="va">p_10step_exo</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">preds</span>, use <span class="op">=</span> <span class="st">"pairwise"</span><span class="op">)</span></span>
<span><span class="co">#&gt;               p_1step_endo p_2step_endo p_10step_endo p_1step_exo p_2step_exo</span></span>
<span><span class="co">#&gt; p_1step_endo     1.0000000    0.9989157     0.9989135   0.9973023   0.9962257</span></span>
<span><span class="co">#&gt; p_2step_endo     0.9989157    1.0000000     0.9999972   0.9962491   0.9970523</span></span>
<span><span class="co">#&gt; p_10step_endo    0.9989135    0.9999972     1.0000000   0.9962476   0.9970503</span></span>
<span><span class="co">#&gt; p_1step_exo      0.9973023    0.9962491     0.9962476   1.0000000   0.9991798</span></span>
<span><span class="co">#&gt; p_2step_exo      0.9962257    0.9970523     0.9970503   0.9991798   1.0000000</span></span>
<span><span class="co">#&gt; p_10step_exo     0.9962125    0.9970381     0.9970410   0.9991785   0.9999984</span></span>
<span><span class="co">#&gt;               p_10step_exo</span></span>
<span><span class="co">#&gt; p_1step_endo     0.9962125</span></span>
<span><span class="co">#&gt; p_2step_endo     0.9970381</span></span>
<span><span class="co">#&gt; p_10step_endo    0.9970410</span></span>
<span><span class="co">#&gt; p_1step_exo      0.9991785</span></span>
<span><span class="co">#&gt; p_2step_exo      0.9999984</span></span>
<span><span class="co">#&gt; p_10step_exo     1.0000000</span></span></code></pre></div>
<p>Evidently (and as expected) these predictions are all very highly correlated with each other. Note that there are going to be missing (NA) values at the front end of the prediction vector, since some observations are eaten up by lags in the fitting procedure.</p>
</div>
<div class="section level3">
<h3 id="cumulative-predictions">Cumulative predictions<a class="anchor" aria-label="anchor" href="#cumulative-predictions"></a>
</h3>
<p>From an applied perspective, it’s not very useful to predict how many visits an ED might see in the next hour, or in the next 10 hours. It’s much more useful to be able to predict how many patients might come in in a given 10 hour (shift-length) period. The <code>predict.srlTS</code> function provides some functionality for <span class="math inline">\(k\)</span>-step ahead <em>cumulative</em> (rolling sum) predictions via the <code>cumulative</code> argument.</p>
<p>Let’s calculate 10-hour rolling sum predictions using the 1-10 step ahead predictions using both models.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y_c10hr</span> <span class="op">&lt;-</span> <span class="fu">RcppRoll</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RcppRoll/man/RcppRoll-exports.html" class="external-link">roll_sum</a></span><span class="op">(</span><span class="va">y</span>, <span class="fl">10</span>, align <span class="op">=</span> <span class="st">"right"</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="va">p_10step_csum_endo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">srlpac</span>, n_ahead <span class="op">=</span> <span class="fl">10</span>, cumulative <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">p_10step_csum_exo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">srlpacx</span>, n_ahead <span class="op">=</span> <span class="fl">10</span>, cumulative <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<p>We can compute mean absolute error (MAE) (and other similar metrics) using the functionality from the <code>yardstick</code> package.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mae_vec</span><span class="op">(</span><span class="va">y_c10hr</span>, <span class="va">p_10step_csum_endo</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 6.820224</span></span>
<span><span class="fu">mae_vec</span><span class="op">(</span><span class="va">y_c10hr</span>, <span class="va">p_10step_csum_exo</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 6.788572</span></span></code></pre></div>
<p>So the SRLPAC(x) methods were able to predict the number of patients who arrive in a given 10-hour window to within an average of about 6.8 patients.</p>
<p>It may be pertinent to investigate this predictive accuracy only on the test data set, which can be done by extracting the <code>train_idx</code> object from the <code>srlTS</code> object.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mae_vec</span><span class="op">(</span><span class="va">y_c10hr</span><span class="op">[</span><span class="op">-</span><span class="va">srlpac</span><span class="op">$</span><span class="va">train_idx</span><span class="op">]</span>, <span class="va">p_10step_csum_endo</span><span class="op">[</span><span class="op">-</span><span class="va">srlpac</span><span class="op">$</span><span class="va">train_idx</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 6.795522</span></span>
<span><span class="fu">mae_vec</span><span class="op">(</span><span class="va">y_c10hr</span><span class="op">[</span><span class="op">-</span><span class="va">srlpacx</span><span class="op">$</span><span class="va">train_idx</span><span class="op">]</span>, <span class="va">p_10step_csum_exo</span><span class="op">[</span><span class="op">-</span><span class="va">srlpacx</span><span class="op">$</span><span class="va">train_idx</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 6.81384</span></span></code></pre></div>
<p>We can also compute the overall R-squared:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rsq_vec</span><span class="op">(</span><span class="va">y_c10hr</span>, <span class="va">p_10step_csum_endo</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.8528324</span></span>
<span><span class="fu">rsq_vec</span><span class="op">(</span><span class="va">y_c10hr</span>, <span class="va">p_10step_csum_exo</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.855573</span></span></code></pre></div>
<p>And the R-squared just for the test data.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rsq_vec</span><span class="op">(</span><span class="va">y_c10hr</span><span class="op">[</span><span class="op">-</span><span class="va">srlpac</span><span class="op">$</span><span class="va">train_idx</span><span class="op">]</span>, <span class="va">p_10step_csum_endo</span><span class="op">[</span><span class="op">-</span><span class="va">srlpac</span><span class="op">$</span><span class="va">train_idx</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.8522335</span></span>
<span><span class="fu">rsq_vec</span><span class="op">(</span><span class="va">y_c10hr</span><span class="op">[</span><span class="op">-</span><span class="va">srlpacx</span><span class="op">$</span><span class="va">train_idx</span><span class="op">]</span>, <span class="va">p_10step_csum_exo</span><span class="op">[</span><span class="op">-</span><span class="va">srlpacx</span><span class="op">$</span><span class="va">train_idx</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.8529352</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="conclusions">Conclusions<a class="anchor" aria-label="anchor" href="#conclusions"></a>
</h2>
<p>In ongoing work we are comparing the SRL-based approaches to other competing approaches.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Ryan Andrew Peterson.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
